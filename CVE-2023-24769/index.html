<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Blog | Edoardo Ottavianelli</title>

    <meta name="robots" content="index,follow" />
    <link rel="canonical" href="https://www.edoardoottavianelli.it/" />
    <meta name="description"
        content="Edoardo Ottavianelli, Cybersecurity Student at Sapienza University. Passionate about Computing, Nature and cooking." />
    <meta name="keywords"
        content="Edoardo Ottavianelli, Cybersecurity, Computer Science, Science, Information Technology, Software, Developer, Coding, Programming, Hardware, Innovation, edoardo, ottavianellli" />
    <meta name="author" content="Edoardo Ottavianelli" />
    <meta name="copyright" content="Edoardo Ottavianelli" />
    <meta property="og:title" content="Edoardo Ottavianelli" />
    <meta property="og:site_name" content="Edoardo Ottavianelli" />
    <meta property="og:description"
        content="Edoardo Ottavianelli, Cybersecurity Student at Sapienza University. Passionate about Computing, Nature and cooking." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.edoardoottavianelli.it" />
    <meta property="og:image" content="https://www.edoardoottavianelli.it/media/og.png" />
    <meta property="og:image:secure_url" content="https://www.edoardoottavianelli.it/media/og.png" />
    <meta property="og:image:type" content="image/png" />
    <meta name="twitter:card" content="photo" />
    <meta name="twitter:title" content="Edoardo Ottavianelli" />
    <meta name="twitter:description"
        content="Edoardo Ottavianelli, Cybersecurity Student at Sapienza University.Passionate about Computing, Nature and cooking." />
    <meta name="twitter:image" content="https://www.edoardoottavianelli.it/media/og.png" />
    <meta name="twitter:url" content="https://www.edoardoottavianelli.it" />
    <meta name="twitter:site" content="@edoardottt2" />
    <meta name="twitter:creator" content="@edoardottt2" />
    <meta name="apple-mobile-web-app-title" content="Edoardo Ottavianelli" />
    <link rel="apple-touch-icon" sizes="144x144" href="https://www.edoardoottavianelli.it/media/logo_edo.png" />
    <meta name="application-name" content="edoardo ottavianelli" />
    <meta name="viewport" content="width=device-width" />
    <meta name="theme-color" content="#ffffff" />

    <!-- MDB icon -->
    <link rel="icon" href="../media/logo_edo.jpg">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css">
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&amp;display=swap">
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Material Design Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.19.1/css/mdb.min.css" rel="stylesheet">
</head>

<body>
    <header>

        <!-- Navbar -->
        <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary white scrolling-navbar">
            <div class="container">

                <!-- Brand -->
                <a class="navbar-brand waves-effect" href="../index.html" title="home edoardo ottavianelli">
                    <strong class="white-text">edoardotttðŸ‘¹</strong>
                </a>

                <!-- Collapse -->
                <button class="navbar-toggler" type="button" data-toggle="collapse"
                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Links -->
                <div class="collapse navbar-collapse" id="navbarSupportedContent">

                    <!-- Left -->
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link waves-effect" href="../index.html"
                                title="home edoardo ottavianelli">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link waves-effect" href="../blog.html" title="Blog edoardo ottavianelli">Blog
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link waves-effect" href="../cve.html"
                                title="CVE edoardo ottavianelli">CVEs</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link waves-effect" href="../aboutme.html"
                                title="About me edoardo ottavianelli">About
                                me</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link waves-effect" href="../cv.html"
                                title="cv edoardo ottavianelli">Curriculum Vitae</a>
                        </li>
                    </ul>

                    <!-- Right -->
                    <ul class="navbar-nav nav-flex-icons">
                        <li class="nav-item">
                            <a href="https://instagram.com/edoardottt" class="nav-link waves-effect"
                                title="instagram edoardottt">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="https://twitter.com/edoardottt2" class="nav-link waves-effect"
                                title="twitter edoardottt">
                                <i class="fab fa-twitter"></i>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="https://github.com/edoardottt"
                                class="nav-link border border-light rounded waves-effect" title="github edoardottt"
                                target="_blank">
                                <i class="fab fa-github mr-2"></i>GitHub
                            </a>
                        </li>
                    </ul>

                </div>

            </div>
        </nav>
        <!-- Navbar -->

    </header>
    <!--Main Navigation-->

    <!--Main layout-->
    <main class="mt-5 pt-5">
        <div class="container">

            <!--Section: Jumbotron-->
            <section class="card blue-gradient wow fadeIn" id="intro">

                <!-- Content -->
                <div class="card-body text-white text-center py-2 px-2 my-2">

                    <h1 class="mb-4">
                        <strong>Edoardo Ottavianelli</strong>
                    </h1>
                    <p class="mb-4">
                        <strong>Cybersecurity Student at Sapienza University.
                            Passionate about Computing, Nature and cooking.</strong>
                    </p>
                    <a target="_blank" href="mailto:edoardott@gmail.com" class="btn btn-outline-white btn-lg"
                        title="mail edoardo ottavianelli">Contact me
                        <i class="fas fa-envelope"></i>
                    </a>
                </div>
                <!-- Content -->
            </section>
            <!--Section: Jumbotron-->

            <!--Section: Cards-->
            <section class="pt-5">
                <div class="container">

                    <!--Grid row-->
                    <div class="row wow fadeInd-flex fadeIn justify-content-center">
                        <!--Grid column CENTER-->
                        <div class="col-1">
                            <br>
                        </div>
                        <!--Grid column-->

                        <!--Grid column-->
                        <div class="col-lg-10 col-xl-10 ml-xl-10 mb-10 view overlay rounded z-depth-1">
                            <h3 class="mb-3 font-weight-bold dark-grey-text">
                                <strong>CVE-2023-24769</strong>
                            </h3>
                            Author: Edoardo Ottavianelli<br>15/02/2023<br><br>

                            In this post I will go through CVE-2023-24769: the description, replication of the
                            vulnerability and POC.
                            <br><br>
                            <a target="_blank" href="https://github.com/dgtlmoon/changedetection.io"
                                alt="changedetection.io">changedetection.io</a> is an Open-source
                            Python based platform notifying users about changes of public and private websites. It can
                            be self-hosted (I have this solution installed locally on my second machine, a
                            lightweight laptop) or it's possible to let them host your website change monitor solution
                            paying a monthly subscription (<a target="_blank"
                                href="https://github.com/dgtlmoon/changedetection.io">link
                                to the GitHub repo</a>).
                            From the GitHub description we can read:
                            <br>
                            <cite>"The best and simplest self-hosted free open source website change detection, monitor
                                and notification service. Restock Monitor, change detection. Designed for simplicity -
                                the main goal is to simply monitor which websites had a text change for free. Free Open
                                source web page change detection, Restock Monitoring, Visualping and Apify
                                alternative."</cite>.
                            <br><br>

                            Honestly I have to admit it's really a fantastic product, I have it installed locally and
                            it's just amazing. All the promises are kept: it's simple, fast, intuitive and effective.
                            <ul>
                                <li>It supports 85 different notification systems (I use my Telegram bot)</li>
                                <li>It's possible to use a headless browser and monitor visual changes (instead of pure
                                    text)</li>
                                <li>It's possible to select specific changes to be monitored (through regular
                                    expressions)</li>
                                <li>It's possible to import multiple URLs as a list</li>
                                <li>Open source, fast and effective support (my security issue fixed and closed in less
                                    than a day)</li>
                                <li>Many more pros</li>
                            </ul>

                            <img src="changedetection.png" width="100%" title="changedetection cve"
                                alt="changedetection cve">
                            <br>

                            <h4>Description of the vulnerability</h4>
                            When adding a new URL to monitor, it's possible to add a URL having the protocol
                            <b>javascript</b>, this leads to a Cross Site Scripting vulnerability. Even if partially
                            blocked by modern browsers (I'm using Chrome v110.*..), the attack is still possible if the
                            victim uses CTRL + click to open the link.<br>
                            The payload used to prove the vulnerability is <b>javascript:alert(document.domain)</b>. As
                            suggested by changedectection.io maintainer (@dgtlmoon), the best solution was to block the
                            URLs with protocols not in this list: HTTP, HTTPS, FTP, FILE. These are the only protocols
                            allowed. Note that file:// protocol is not used anymore because it can leads to security
                            vulnerabilities as well (<b>file:///etc/passwd</b> easy peasy).<br>
                            I've opened an issue in GitHub issue tracker
                            (<a target="_blank"
                                href="https://github.com/dgtlmoon/changedetection.io/issues/1358">https://github.com/dgtlmoon/changedetection.io/issues/1358</a>)
                            and after few hours the
                            maintainer provided a patch (<a target="_blank"
                                href="https://github.com/dgtlmoon/changedetection.io/pull/1359">https://github.com/dgtlmoon/changedetection.io/pull/1359</a>).
                            <br><br>
                            This attack can be carried out also using the <i>Import</i> feature:
                            <pre>
{
    "client":{
        "local":1
    },
    "data":[
        {
            "name":"javascript:alert(document.domain)",
            "uri":"javascript:alert(document.domain)",
            "config":"{\"selections\":[]}",
            "tags":[]
        }
    ]
}                            </pre>
                            <b>Note that</b> as stated in the GitHub issue, there wasn't a single way to exploit the
                            vulnerability: an attacker could
                            <ul>
                                <li>Deploy a changedetection.io instance locally</li>
                                <li>Create a vulnerable watch with the payload specified above</li>
                                <li>Click on share the watch and get a link like this:
                                    https://changedetection.io/share/LpbICKx5Rbca</li>
                                <li>Use that link for phishing purposes</li>
                            </ul>
                            <br>
                            This is the code patching the vuln:<br><br>
                            <pre>
# Allowable protocols, protects against javascript: etc
# file:// is further checked by ALLOW_FILE_URI
SAFE_PROTOCOL_REGEX='^(http|https|ftp|file):'

def is_safe_url(test_url):
    # See https://github.com/dgtlmoon/changedetection.io/issues/1358
    
    # Remove 'source:' prefix so we dont get 'source:javascript:' etc
    # 'source:' is a valid way to tell us to return the source
    
    r = re.compile(re.escape('source:'), re.IGNORECASE)
    test_url = r.sub('', test_url)
    
    pattern = re.compile(os.getenv('SAFE_PROTOCOL_REGEX', SAFE_PROTOCOL_REGEX), re.IGNORECASE)
    if not pattern.match(test_url.strip()):
        return False
    
    return True
</pre>
                            With this patch the problem is now fixed.
                            <br><br>

                            <h4>Replication of the vulnerability</h4>
                            <ul>
                                <li>Go to the main page</li>
                                <li>Under Add a new change detection watch add as URL javascript:alert(document.domain)
                                </li>
                                <li>Click Watch</li>
                                <li>A new row is added under the websites watched</li>
                                <li>Click CTRL + click with mouse on the link taking to a new tab</li>
                                <li>Javascript payload is executed</li>
                            </ul>
                            <img src="poc1.png" width="100%" title="changedetection cve poc"
                                alt="changedetection cve poc">
                            <br><br>
                            <h4>POC</h4>
                            See the Youtube Video POC here:<br>
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/TRTpRlkU3Hc"
                                title="YouTube video player" frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                                allowfullscreen></iframe>
                            <br><br>

                            <h4>References</h4>
                            <ul>
                                <li><a target="_blank"
                                        href="https://nvd.nist.gov/vuln/detail/CVE-2023-24769">https://nvd.nist.gov/vuln/detail/CVE-2023-24769</a>
                                </li>
                                <li><a target="_blank"
                                        href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-24769">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-24769</a>
                                </li>
                                <li><a target="_blank"
                                        href="https://github.com/dgtlmoon/changedetection.io/issues/1358">https://github.com/dgtlmoon/changedetection.io/issues/1358</a>
                                </li>
                                <li><a target="_blank"
                                        href="https://github.com/dgtlmoon/changedetection.io/pull/1359">https://github.com/dgtlmoon/changedetection.io/pull/1359</a>
                                </li>
                                <li><a target="_blank"
                                        href="https://www.youtube.com/embed/TRTpRlkU3Hc">https://www.youtube.com/embed/TRTpRlkU3Hc</a>
                                </li>
                            </ul>
                            <br><br><br>

                        </div>
                        <!--Grid column-->
                        <!--Grid column CENTER-->
                        <div class="col-1">
                            <br>
                        </div>
                        <!--Grid column-->
                    </div>
                    <!--Grid row-->
                </div>
            </section>
            <!--Section: Cards-->

        </div>
    </main>
    <!--Main layout-->

    <!--Footer-->
    <footer class="page-footer text-center font-small mdb-color darken-2 mt-4 wow fadeIn">

        <!--Call to action-->
        <div class="pt-4">
            <a class="btn btn-outline-white" href="mailto:edoardott@gmail.com" target="_blank" role="button"
                title="mail edoardo ottavianelli">Contact me
                <i class="fas fa-envelope ml-2"></i>
            </a>
        </div>
        <!--/.Call to action-->

        <hr class="my-4">

        <!-- Social icons -->
        <div class="pb-4">
            <a href="https://www.facebook.com/edoardo.ottavianelli" target="_blank"
                title="facebook edoardo ottavianelli">
                <i class="fab fa-facebook-f mr-3"></i>
            </a>

            <a href="https://twitter.com/edoardottt2" target="_blank" title="twitter edoardo ottavianelli">
                <i class="fab fa-twitter mr-3"></i>
            </a>

            <a href="https://github.com/edoardottt" target="_blank" title="github edoardo ottavianelli">
                <i class="fab fa-github mr-3"></i>
            </a>

            <a href="https://instagram.com/edoardottt" target="_blank" title="instagram edoardo ottavianelli">
                <i class="fab fa-instagram mr-3"></i>
            </a>

            <a href="https://www.linkedin.com/in/edoardoottavianelli/" target="_blank"
                title="linkedin edoardo ottavianelli">
                <i class="fab fa-linkedin mr-3"></i>
            </a>

            <a href="https://t.me/edoardottt" target="_blank" title="telegram edoardo ottavianelli">
                <i class="fab fa-telegram mr-3"></i>
            </a>

            <a href="https://stackoverflow.com/users/8155097/edoardottt" target="_blank"
                title="stackoverflow edoardo ottavianelli">
                <i class="fab fa-stack-overflow mr-3"></i>
            </a>

            <a href="https://www.youtube.com/@edoardottt" title="edoardo ottavianelli youtube" target="_blank">
                <i class="fab fa-youtube mr-3"></i>
            </a>

            <a href="https://www.hackerrank.com/edoardottt" title="edoardo ottavianelli hackerrank" target="_blank">
                <i class="fab fa-hackerrank mr-3"></i>
            </a>

            <a href="https://dev.to/edoardottt" title="edoardo ottavianelli dev.to" target="_blank">
                <i class="fab fa-dev mr-3"></i>
            </a>

        </div>
        <!-- Social icons -->

        <!--Copyright-->
        <div class="footer-copyright py-3">
            &#xA9; edoardottt <br>Thanks to
            <a href="https://mdbootstrap.com/education/bootstrap/" target="_blank"> MDBootstrap.com </a>
        </div>
        <!--/.Copyright-->

    </footer>
    <!--/.Footer-->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"
        async></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"
        async></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"
        async></script>

    <script type="text/javascript" src="../js/mdb.min.js" async></script>

    <script type='application/ld+json'>
        {
            "@context": "http://www.schema.org/",
            "@type": "Person",
            "name": "Edoardo Ottavianelli",
            "jobTitle": "Software Developer",
            "url": "https://www.edoardoottavianelli.it",
            "image": "https://www.edoardoottavianelli.it/logo_edo.jpg",
            "sameAs": ["https://www.facebook.com/edoardo.ottavianelli", "https://twitter.com/edoardottt2", "https://www.instagram.com/edoardottt", "https://www.linkedin.com/in/edoardoottavianelli/"],
            "email": "edoardott@gmail.com"
        }
    </script>
    <script type="text/javascript">
        new WOW().init();
    </script>
</body>

</html>